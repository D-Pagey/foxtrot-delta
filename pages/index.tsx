import type { GetServerSideProps, NextPage } from "next";
import axios from "axios";
import Head from "next/head";

import { Menu } from "../types";
import Image from "next/image";

type Props = {
  menuData: Menu;
};

const Home: NextPage<Props> = ({ menuData }) => {
  // console.log(menuData);

  return (
    <div>
      <Head>
        <title>Foxtrot Delta</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="flex flex-col p-4">
        <h2 className="text-center mb-4 text-2xl font-bold">Menu</h2>

        <ul>
          {menuData.MenuSections.map((section) => (
            <li className="mb-8" key={section.MenuSectionId}>
              <h2 className="font-bold text-xl mb-4">{section.Name}</h2>
              {section.MenuItems.map((menuItem) => (
                <div
                  key={menuItem.PublicId}
                  className="grid items-center gap-x-4 border-b py-4"
                  style={{ gridTemplateColumns: "1fr max-content" }}
                >
                  <p className="col-start-1 row-start-1">{menuItem.Name}</p>
                  <p className="col-start-1 row-start-2">Â£{menuItem.Price}</p>
                  <p>{menuItem.Description}</p>
                  {menuItem.ImageUrl && (
                    <div className="flex col-start-2 row-start-1 row-end-4 rounded overflow-hidden">
                      <Image
                        src={menuItem.ImageUrl}
                        alt={menuItem.Description}
                        width="100"
                        height="100"
                      />
                    </div>
                  )}
                </div>
              ))}
            </li>
          ))}
        </ul>
      </main>
    </div>
  );
};

export default Home;

export const getServerSideProps: GetServerSideProps = async (context) => {
  const { data } = await axios.get<Menu>(
    "https://menus.flipdish.co/prod/16798/e6220da2-c34a-4ea2-bb51-a3e190fc5f08.json"
  );

  return {
    props: {
      menuData: data,
    },
  };
};
