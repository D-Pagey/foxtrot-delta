import type { GetServerSideProps, NextPage } from "next";
import axios from "axios";
import Head from "next/head";
import Image from "next/image";

import { Menu } from "../types";
import { MenuItem } from "../components/MenuItem";

type Props = {
  menuData: Menu;
};

const Home: NextPage<Props> = ({ menuData }) => {
  return (
    <div>
      {/* Meta data */}
      <Head>
        <title>Foxtrot Delta</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="flex flex-col p-4 items-center">
        <h2 className="mb-4 text-2xl font-bold text-fdBlue">Menu</h2>

        {/* List of sections */}
        <ul className="max-w-2xl">
          {menuData.MenuSections.map((section) => (
            <li className="mb-8" key={section.MenuSectionId}>
              <h2 className="font-bold text-xl mb-4 text-fdBlue">
                {section.Name}
              </h2>

              {/* List of menu items */}
              {section.MenuItems.map((menuItem) => {
                const {
                  Price,
                  PublicId,
                  Name,
                  Description,
                  ImageUrl,
                  MenuItemOptionSets,
                } = menuItem;

                const standaloneOptions = MenuItemOptionSets.find(
                  (option) => option.IsMasterOptionSet
                );

                if (standaloneOptions) {
                  return standaloneOptions.MenuItemOptionSetItems.map(
                    (option) => (
                      <MenuItem
                        key={option.PublicId}
                        Price={option.Price}
                        Name={`${Name} - ${option.Name}`}
                        Description={Description}
                        ImageUrl={ImageUrl}
                      />
                    )
                  );
                }

                return (
                  <MenuItem
                    key={PublicId}
                    Price={Price}
                    Name={Name}
                    Description={Description}
                    ImageUrl={ImageUrl}
                  />
                );
              })}
            </li>
          ))}
        </ul>
      </main>
    </div>
  );
};

export default Home;

// Server Side Rendering
export const getServerSideProps: GetServerSideProps = async (context) => {
  const { data } = await axios.get<Menu>(
    "https://menus.flipdish.co/prod/16798/e6220da2-c34a-4ea2-bb51-a3e190fc5f08.json"
  );

  return {
    props: {
      menuData: data,
    },
  };
};
